<?xml version="1.0" encoding="utf-8"?>
<app:ConsilioApplication xmlns:app="de.bht.consilio.application.*"
						 xmlns:fx="http://ns.adobe.com/mxml/2009"
						 xmlns:s="library://ns.adobe.com/flex/spark"
						 xmlns:mx="library://ns.adobe.com/flex/mx"
						 xmlns:ConsilioCustomComponents="de.bht.ConsilioCustomComponents.*"
						 width="1280" height="720" windowComplete="consumer.subscribe()">
	<app:layout>
		<s:BasicLayout/>
	</app:layout>
	
	<fx:Declarations>
		<mx:Consumer id="consumer" destination="chat" fault="faultHandler(event);"
					 message="messageHandler(event.message)"/>
		<mx:Producer id="producer" destination="chat" fault="faultHandler(event);"/>
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import mx.messaging.events.MessageFaultEvent;
			import mx.messaging.messages.AsyncMessage;
			import mx.messaging.messages.IMessage;
			
			private function send():void{
				var message:IMessage = new AsyncMessage();
				message.body.chatMessage = msg.text;
				producer.send(message);
				msg.text = "";
			}
			
			private function messageHandler(message:IMessage):void{
				log.text += message.body.chatMessage + "\n";
			}
			
			// Handle a message fault.
			private function faultHandler(event:MessageFaultEvent):void {
				log.text += "Received fault: " + event.faultString + "\n";
			}
		]]>
	</fx:Script>
	<s:BorderContainer id="mainContainer" x="0" y="0" width="100%" height="100%"
					   backgroundColor="#676464" borderWeight="0" cornerRadius="0">
	</s:BorderContainer>
	<mx:Panel right="5" bottom="5" width="200" height="200" title="Chat">
		<mx:TextArea id="log" width="100%" height="100%" borderVisible="false"/>
		<mx:ControlBar>
			<mx:TextInput id="msg" width="100%" enter="send()"/>
			<mx:Button label="Send" click="send()"/>
		</mx:ControlBar>
	</mx:Panel>
	
	<ConsilioCustomComponents:BottomMenu id="bottomMenu" left="5" bottom="5" />
	
	
</app:ConsilioApplication>
